# Configuration de la base de donn?es
spring.datasource.url=jdbc:mysql://${MYSQL_ADDON_HOST}:${MYSQL_ADDON_PORT}/${MYSQL_ADDON_DB}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&createDatabaseIfNotExist=true
spring.datasource.username=${MYSQL_ADDON_USER}
spring.datasource.password=${MYSQL_ADDON_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver


mailjet.api-key=${MAILJET_API}
mailjet.secret-key=${MAILJET_SECRET}


# Configuration JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=false

# Configuration Thymeleaf - CACHE ACTIV? EN PRODUCTION
spring.thymeleaf.cache=true
server.error.whitelabel.enabled=false


# Limites d'upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=30MB

# Configuration des logs - Optimis? pour la production
logging.level.root=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.level.com.marketcore=INFO
logging.level.org.springframework.boot.autoconfigure.jdbc=WARN
logging.level.com.zaxxer.hikari=WARN

# Logs sp?cifiques pour le monitoring
logging.level.org.springframework.security=WARN
logging.level.org.springframework.transaction=WARN

# S?curit?
server.tomcat.remote_ip_header=x-forwarded-for
server.tomcat.protocol_header=x-forwarded-proto

# Configuration du serveur
server.port=${SERVER_PORT:8080}
server.ssl.enabled=${SSL_ENABLED:false}

# Initialisation de la base de donn?es
spring.sql.init.mode=NEVER
app.upload.dir=${CC_FS_BUCKET}

# ==========================================
# OPTIMISATIONS DE PERFORMANCE - PRODUCTION
# ==========================================

# Compression Gzip/Brotli pour r?duire drastiquement la taille des fichiers
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml

# Cache agressif des ressources statiques (1 an)
spring.web.resources.cache.cachecontrol.max-age=31536000
spring.web.resources.cache.cachecontrol.cache-public=true
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**



# ==========================================
# MONITORING & ACTUATOR - PRODUCTION
# ==========================================
management.endpoints.web.exposure.include=health,metrics,info
management.endpoint.health.show-details=never
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true

# ==========================================
# GESTION DES SESSIONS (Éviter accumulation)
# ==========================================
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.max-age=1800

# ==========================================
# CONFIGURATION TOMCAT (Limiter les threads)
# ==========================================
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20000
server.tomcat.max-connections=10000
server.tomcat.accept-count=100


# ==========================================
# CONFIGURATION JPA/HIBERNATE (Optimisation)
# ==========================================
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

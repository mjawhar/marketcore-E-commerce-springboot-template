document.addEventListener("DOMContentLoaded",function(){document.addEventListener("submit",function(t){const e=t.target;if(e.classList.contains("add-to-cart-form")){t.preventDefault();const n=e.querySelector('input[name="qty"]'),o=n?n.value:1,c=document.querySelector('meta[name="_csrf"]').getAttribute("content"),r=document.querySelector('meta[name="_csrf_header"]').getAttribute("content");fetch(e.action,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",[r]:c},body:new URLSearchParams({qty:o})}).then(t=>{if(!t.ok)throw new Error("Erreur réseau");return t.json()}).then(t=>{t.success&&(fetch("/cart/count",{headers:{Accept:"application/json"}}).then(t=>t.json()).then(t=>{const e=document.getElementById("cart-count");if(e){const n=parseInt(t.count);e.textContent=n,e.style.display=n<=0?"none":"flex"}}).catch(t=>{console.error("Erreur lors de la récupération du nombre d'articles dans le panier:",t)}),function(t){document.getElementById("cart-popup-product-name").textContent=t.productName,document.getElementById("cart-popup-quantity").textContent=t.quantity,document.getElementById("cart-popup-price").textContent=(e=t.productPrice,new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)+" DT");var e;const n=document.getElementById("cart-popup-image"),o=`/images/${t.productId}/1`;n.src=o,n.onerror=function(){this.src="/img/placeholder.png"};document.getElementById("cart-popup").classList.remove("hidden"),document.body.style.overflow="hidden"}(t))}).catch(t=>{console.error("Erreur lors de l'ajout au panier:",t)})}});const t=document.getElementById("close-cart-popup"),e=document.getElementById("cart-popup-overlay"),n=document.getElementById("cart-popup-continue");function o(){const t=document.getElementById("cart-popup");t&&(t.classList.add("hidden"),document.body.style.overflow="")}t&&t.addEventListener("click",o),e&&e.addEventListener("click",o),n&&n.addEventListener("click",o)});
<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="~{fragments/layout :: layout(~{::content})}">
    <div th:fragment="content">

<!-- Navigation vendeur moderne avec sidebar -->
<div class="flex min-h-screen bg-gray-50">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-lg">
        <div class="p-6 border-b">
            <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-store text-blue-600 mr-2"></i><span th:text="#{seller.menu.space}">Espace Vendeur</span>
            </h2>
        </div>

        <nav class="mt-6">
            <a th:href="@{/seller/dashboard}"
               class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors">
                <i class="fas fa-chart-line mr-3"></i>
                <span th:text="#{seller.menu.dashboard}">Tableau de bord</span>
            </a>
            <a th:href="@{/seller/products}"
               class="flex items-center px-6 py-3 text-blue-600 bg-blue-50 border-r-2 border-blue-600">
                <i class="fas fa-box mr-3"></i>
                <span th:text="#{seller.menu.products}">Mes Produits</span>
            </a>
            <a th:href="@{/seller/orders}"
               class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors">
                <i class="fas fa-shopping-cart mr-3"></i>
                <span th:text="#{seller.menu.orders}">Mes Commandes</span>
            </a>

        </nav>
    </div>

    <!-- Contenu principal -->
    <div class="flex-1 p-8">
        <!-- En-tête -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-box text-blue-600 mr-3"></i><span th:text="#{seller.products.title}">Mes Produits</span>
            </h1>
            <p class="text-gray-600" th:text="#{seller.products.subtitle}">Gérez votre catalogue de produits</p>
        </div>

        <!-- Messages de succès/erreur -->
        <div th:if="${success}" class="mb-6 bg-green-50 border-l-4 border-green-400 p-4 rounded-lg shadow-sm">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-check-circle text-green-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-green-800 font-medium" th:text="${success}">Succès!</p>
                </div>
            </div>
        </div>

        <div th:if="${error}" class="mb-6 bg-red-50 border-l-4 border-red-400 p-4 rounded-lg shadow-sm">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-red-800 font-medium" th:text="${error}">Erreur!</p>
                </div>
            </div>
        </div>

        <!-- Actions et filtres -->
        <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div class="flex items-center space-x-4">
                <button id="toggleAddForm"
                        class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 shadow-lg hover:shadow-xl">
                    <i class="fas fa-plus mr-2"></i>
                    <span id="toggleText" th:text="#{seller.products.add}">Ajouter un produit</span>
                </button>

                <div class="text-sm text-gray-600 bg-white px-4 py-2 rounded-lg shadow">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span th:text="${#lists.size(products ?: {})} + ' ' + #{seller.products.count}">0 produit(s)</span>
                </div>
            </div>

            <!-- Filtres -->
            <div class="flex space-x-2">
                <select class="border border-gray-300 rounded-lg px-4 py-2 bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option th:text="#{seller.products.filter.all.types}">Tous les types</option>
                    <option th:text="#{seller.products.filter.new}">Neuf</option>
                    <option th:text="#{seller.products.filter.used}">D'occasion</option>
                </select>
                <select class="border border-gray-300 rounded-lg px-4 py-2 bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option th:text="#{seller.products.filter.all.stocks}">Tous les stocks</option>
                    <option th:text="#{seller.products.filter.in.stock}">En stock</option>
                    <option th:text="#{seller.products.filter.out.stock}">Rupture de stock</option>
                </select>
            </div>
        </div>

        <!-- Formulaire d'ajout (caché par défaut) -->
        <div id="addProductForm" class="hidden mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-600">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-blue-600 mr-2"></i>
                    <span th:text="#{seller.products.form.add.title}">Ajouter un nouveau produit</span>
                </h2>
                <form th:action="@{/seller/products}" method="post" enctype="multipart/form-data" class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-tag mr-1"></i><span th:text="#{seller.products.form.title}">Titre</span> *
                            </label>
                            <input type="text" name="title"
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   th:placeholder="#{seller.products.form.title}" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-copyright mr-1"></i><span th:text="#{seller.products.form.brand}">Marque</span>
                            </label>
                            <input type="text" name="brand"
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   th:placeholder="#{seller.products.form.brand.placeholder}">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-folder mr-1"></i><span th:text="#{seller.products.form.category}">Catégorie</span> *
                            </label>
                            <select name="categoryId"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                    required>
                                <option value="" disabled selected th:text="#{seller.products.form.category.select}">-- Sélectionner une catégorie --</option>
                                <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}">Catégorie</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-euro-sign mr-1"></i><span th:text="#{seller.products.form.price}">Prix</span> *
                            </label>
                            <input type="text" name="priceStr"
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   placeholder="0.00" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-percentage mr-1"></i><span th:text="#{seller.products.form.discounted.price}">Prix réduit (optionnel)</span>
                            </label>
                            <input type="text" name="discountedPriceStr"
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   th:placeholder="#{seller.products.form.discounted.price}">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-warehouse mr-1"></i><span th:text="#{seller.products.form.stock}">Stock</span> *
                            </label>
                            <select name="stock"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                    required>
                                <option value="" disabled selected th:text="#{seller.products.form.stock.select}">-- Sélectionner le statut du stock --</option>
                                <option value="instock" th:text="#{seller.products.form.stock.instock}">En stock</option>
                                <option value="outofstock" th:text="#{seller.products.form.stock.outofstock}">Rupture de stock</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-layer-group mr-1"></i><span th:text="#{seller.products.form.type}">Type de produit</span> *
                            </label>
                            <select name="productType"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                    required>
                                <option value="" disabled selected th:text="#{seller.products.form.type.select}">-- Sélectionner le type de produit --</option>
                                <option value="NEW" th:text="#{seller.products.form.type.new}">Neuf</option>
                                <option value="USED" th:text="#{seller.products.form.type.used}">D'occasion</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-align-left mr-1"></i><span th:text="#{seller.products.form.short.desc}">Description courte</span> *
                            </label>
                            <textarea name="shortDescription" rows="2"
                                      class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                      th:placeholder="#{seller.products.form.short.desc.placeholder}" required></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-align-left mr-1"></i><span th:text="#{seller.products.form.description}">Description</span>
                            </label>
                            <textarea name="description" rows="4"
                                      class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                      th:placeholder="#{seller.products.form.description}"></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-image mr-1"></i><span th:text="#{seller.products.form.images}">Images du produit</span> *
                            </label>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="space-y-2">
                                    <label class="block text-xs font-medium text-gray-500" th:text="#{seller.products.form.image1}">Image principale</label>
                                    <input type="file" name="img1"
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                           accept="image/*" required>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-xs font-medium text-gray-500" th:text="#{seller.products.form.image2}">Image 2</label>
                                    <input type="file" name="img2"
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                           accept="image/*">
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-xs font-medium text-gray-500" th:text="#{seller.products.form.image3}">Image 3</label>
                                    <input type="file" name="img3"
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                           accept="image/*">
                                </div>
                            </div>
                        </div>

                        <div class="md:col-span-2 flex justify-end space-x-4 pt-4">
                            <button type="button" id="cancelAdd"
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                                <span th:text="#{seller.products.form.cancel}">Annuler</span>
                            </button>
                            <button type="submit"
                                    class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200 shadow-lg">
                                <i class="fas fa-save mr-2"></i>
                                <span th:text="#{seller.products.form.submit}">Enregistrer</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Liste des produits -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                <h3 class="text-lg font-semibold text-gray-800">
                    <i class="fas fa-list mr-2"></i>Catalogue de produits
                </h3>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produit</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr th:each="p : ${products}" class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-12 w-12">
                                        <div class="h-12 w-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                                            <i class="fas fa-box text-white"></i>
                                        </div>
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-gray-900" th:text="${p.title}">Titre</div>
                                        <div class="text-sm text-gray-500" th:text="'ID: ' + ${p.id}">ID: 1</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-bold text-gray-900" th:text="|${#numbers.formatDecimal(p.price.multiply(currencyRate),1,'COMMA',2,'POINT')} ${currencySymbol}|">0 €</div>
                            </td>
                            <td class="px-6 py-4">
                                <span th:text="${p.productType.displayName}"
                                      th:class="${p.productType.name() == 'NEW'} ? 'inline-flex px-3 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full' : 'inline-flex px-3 py-1 text-xs font-medium bg-orange-100 text-orange-800 rounded-full'">
                                    Neuf
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                    En stock
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium">
                                <div class="flex space-x-2">
                                    <a th:href="@{'/seller/products/edit/' + ${p.id}}"
                                       class="text-blue-600 hover:text-blue-900 p-2 hover:bg-blue-50 rounded-lg transition-colors">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{'/seller/products/delete/' + ${p.id}}"
                                       class="text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-lg transition-colors"
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- État vide -->
                <div th:if="${#lists.isEmpty(products ?: {})}" class="text-center py-12">
                    <i class="fas fa-box-open text-gray-300 text-6xl mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Aucun produit</h3>
                    <p class="text-gray-500 mb-6">Commencez par ajouter votre premier produit à votre catalogue.</p>
                    <button onclick="document.getElementById('toggleAddForm').click()"
                            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Ajouter un produit
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggleAddForm');
    const addForm = document.getElementById('addProductForm');
    const toggleText = document.getElementById('toggleText');
    const cancelBtn = document.getElementById('cancelAdd');

    function toggleForm() {
        if (addForm.classList.contains('hidden')) {
            addForm.classList.remove('hidden');
            addForm.style.opacity = '0';
            addForm.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                addForm.style.transition = 'all 0.3s ease';
                addForm.style.opacity = '1';
                addForm.style.transform = 'translateY(0)';
            }, 10);
            toggleText.textContent = 'Annuler';
            toggleBtn.classList.remove('from-blue-600', 'to-blue-700');
            toggleBtn.classList.add('from-gray-600', 'to-gray-700');
        } else {
            addForm.style.transition = 'all 0.3s ease';
            addForm.style.opacity = '0';
            addForm.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                addForm.classList.add('hidden');
            }, 300);
            toggleText.textContent = 'Ajouter un produit';
            toggleBtn.classList.remove('from-gray-600', 'to-gray-700');
            toggleBtn.classList.add('from-blue-600', 'to-blue-700');
        }
    }

    toggleBtn.addEventListener('click', toggleForm);
    if (cancelBtn) {
        cancelBtn.addEventListener('click', toggleForm);
    }
});
</script>

    </div>
</div>
</body>
</html>

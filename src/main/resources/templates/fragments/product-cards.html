<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">



<!-- Section "Glow Energy" avec style amélioré et animations subtiles -->
<div th:fragment="glow-energy-section(products)" class="mb-4 relative py-2">
    <!-- Image de fond décorative avec versions optimisées responsive -->
    <div class="absolute inset-0 w-full h-full opacity-20 z-0">
        <picture>
            <!-- Version WebP pour mobile -->
            <source media="(max-width: 480px)"
                    srcset="/img/optimized/banner-mobile.webp"
                    type="image/webp">
            <!-- Version WebP pour tablette -->
            <source media="(max-width: 768px)"
                    srcset="/img/optimized/banner-tablet.webp"
                    type="image/webp">
            <!-- Version WebP pour desktop -->
            <source media="(min-width: 769px)"
                    srcset="/img/optimized/banner-desktop.webp"
                    type="image/webp">
            <!-- Fallback JPEG optimisé -->
            <img src="/img/optimized/banner-desktop.jpg"
                 alt="Décoration"
                 loading="lazy"
                 class="w-full h-full object-cover">
        </picture>
    </div>

    <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-2">
            <h2 class="text-xl sm:text-2xl font-bold mb-0.5 text-gray-800 bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-500">
                <span th:text="#{products.featured}">Produits en vedette</span>
            </h2>
        </div>

        <!-- Grille de produits avec style spécial -->
        <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-1.5 md:gap-3 mb-1">
            <div th:each="product, stat : ${products}" class="relative rounded-lg bg-white shadow-lg overflow-hidden product-glow-card">
                <!-- Effet de lueur animé en arrière-plan -->
                <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/5 via-purple-500/5 to-pink-500/10 transform rotate-12 scale-150 blur-2xl opacity-0 group-hover:opacity-100 transition-all duration-700"></div>

                <!-- Badge Promo -->
                <div th:if="${product.discountedPrice != null and product.discountedPrice < product.price}"
                     class="absolute top-1 right-1 z-10 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">
                    -<span th:text="${#numbers.formatDecimal((1 - product.discountedPrice / product.price) * 100, 0, 0)}">20</span>%
                </div>

                <a th:href="${@urlHelper.productUrl(product)}" class="block h-full">
                    <!-- Image avec optimisation progressive -->
                    <div class="relative h-40 sm:h-48 md:h-64 lg:h-72 xl:h-80 overflow-hidden bg-gray-100 p-2 md:p-4">
                        <!-- Image locale avec chargement optimisé et responsive -->
                        <img th:if="${product.image1Path != null}"
                             th:src="@{'/images/' + ${product.id} + '/1/thumbnail'}"
                             th:srcset="|@{'/images/' + ${product.id} + '/1/thumbnail'} 300w, @{'/images/' + ${product.id} + '/1/card'} 600w, @{'/images/' + ${product.id} + '/1'} 1200w|"
                             sizes="(max-width: 640px) 50vw, (max-width: 768px) 50vw, (max-width: 1024px) 50vw, 25vw"
                             th:alt="${product.title}"
                             loading="lazy"
                             class="h-full w-full object-contain transform transition-transform duration-500 hover:scale-105 product-img">

                        <!-- Image externe avec responsive -->
                        <img th:if="${product.image1Path == null && product.image1Url != null}"
                             th:src="${product.image1Url}"
                             th:alt="${product.title}"
                             loading="lazy"
                             class="h-full w-full object-contain transform transition-transform duration-500 hover:scale-105">

                        <!-- Image par défaut -->
                        <img th:unless="${product.image1Path != null || product.image1Url != null}"
                             src="/img/placeholder.png"
                             alt="Produit non disponible"
                             class="h-full w-full object-contain opacity-50">
                    </div>

                    <div class="p-1.5 sm:p-2">
                        <div th:if="${product.brand}" class="text-[10px] sm:text-xs text-indigo-600 font-medium mb-0.5" th:text="${product.brand}">
                            Marque
                        </div>

                        <h3 class="text-xs sm:text-sm font-bold text-gray-800 mb-0.5 line-clamp-2" th:text="${product.title}">
                            Nom du produit
                        </h3>

                        <div class="flex items-center gap-1 mb-1">
                            <span class="text-sm sm:text-base font-bold text-gray-900" th:text="${#numbers.formatDecimal((product.discountedPrice != null ? product.discountedPrice : product.price), 0, 2)} + ' ' + ${currencyCode}">
                                49,99 €
                            </span>
                            <span th:if="${product.discountedPrice != null and product.discountedPrice < product.price}" class="text-[10px] sm:text-xs text-gray-500 line-through" th:text="${#numbers.formatDecimal(product.price, 0, 2)} + ' ' + ${currencyCode}">
                                79,99 €
                            </span>
                        </div>

                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="flex">
                                    <svg th:each="i : ${#numbers.sequence(1, 5)}" class="w-2.5 h-2.5 sm:w-3 sm:h-3" th:classappend="${i <= 4} ? 'text-yellow-400' : 'text-gray-300'" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                </div>
                                <span class="text-[10px] sm:text-xs text-gray-600 ml-0.5">(45)</span>
                            </div>
                            <button class="text-white bg-indigo-600 hover:bg-indigo-700 rounded-full p-1 transition-colors" aria-label="Ajouter au panier">
                                <svg class="w-2.5 h-2.5 sm:w-3 sm:h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Script pour charger progressivement les images -->
<script th:fragment="progressive-image-loading">
document.addEventListener('DOMContentLoaded', function() {
    // Optimisation des images avec chargement progressif
    const productImages = document.querySelectorAll('img.product-img');

    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const src = img.dataset.src;
                    if (src) {
                        img.src = src;
                    }
                    observer.unobserve(img);
                }
            });
        }, {
            rootMargin: '50px',
            threshold: 0.1
        });

        productImages.forEach(img => {
            imageObserver.observe(img);
        });
    } else {
        // Fallback pour les navigateurs qui ne prennent pas en charge IntersectionObserver
        productImages.forEach(img => {
            if (img.dataset.src) {
                img.src = img.dataset.src;
            }
        });
    }
});
</script>
</html>
